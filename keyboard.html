<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Original Keyboard</title>
<style>
@font-face {
  font-family: "Haula";
  src: url("Haula-Regular.ttf") format("truetype");
}

body {
  font-family: sans-serif;
  background: #111;
  color: #eee;
  padding: 12px;
}

#output {
  min-height: 80px;
  border: 1px solid #555;
  padding: 10px;
  margin-bottom: 12px;
  font-size: 24px;
  font-family: "Haula", sans-serif;
}

#preview {
  height: 32px;
  margin-bottom: 10px;
  color: #aaa;
  font-family: "Haula", sans-serif;
}

button {
  font-family: "Haula", sans-serif;
}
</style>
</head>
<body>

<div id="output"></div>
<div id="preview"></div>

<div class="row">
  <button onclick="selectPart('f')">f</button>
  <button onclick="selectPart('g')">g</button>
  <button onclick="selectPart('h')">h</button>
  <button class="symbol" onclick="backspace()">⌫</button>
</div>

<div class="row">
  <button onclick="selectPart('i')">i</button>
  <button onclick="selectPart('j')">j</button>
  <button onclick="selectPart('k')">k</button>
  <button onclick="selectPart('l')">l</button>
</div>

<div class="row">
  <button onclick="selectPart('m')">m</button>
  <button onclick="selectPart('n')">n</button>
  <button onclick="selectPart('o')">o</button>
  <button class="symbol" onclick="punctCycle()">!?.</button>
</div>


<script>
let state = { first: null, second: null };

let punctIndex = 0;
const puncts = [".", "?", "!"];

const glyphMap = {
  "f,i,m": "\"", "f,j,m": "'", "f,k,m": ",", "f,l,m": ":",
  "g,i,m": "H", "g,j,m": "I", "g,k,m": "J", "g,l,m": "K",
  "h,i,m": "T", "h,j,m": "U", "h,k,m": "V", "h,l,m": "W",

  "f,i,n": ";", "f,j,n": "A", "f,k,n": "B", "f,l,n": "C",
  "g,i,n": "L", "g,j,n": "M", "g,k,n": "N", "g,l,n": "O",
  "h,i,n": "X", "h,j,n": "Y", "h,k,n": "Z", "h,l,n": "a",

  "f,i,o": "D", "f,j,o": "E", "f,k,o": "F", "f,l,o": "G",
  "g,i,o": "P", "g,j,o": "Q", "g,k,o": "R", "g,l,o": "S",
  "h,i,o": "b", "h,j,o": "c", "h,k,o": "d", "h,l,o": "e"
};

const partialMap = {
  "f,i":"p","f,j":"q","f,k":"r","f,l":"s",
  "g,i":"t","g,j":"u","g,k":"v","g,l":"w",
  "h,i":"x","h,j":"y","h,k":"z","h,l":"―"
};

function punctCycle() {
  const output = document.getElementById("output");
  const char = puncts[punctIndex];
  punctIndex = (punctIndex + 1) % puncts.length;

  // 最後の文字を取得する
  const lastChar = output.textContent.slice(-1);

  if (puncts.includes(lastChar)) {
    // 直前の文字が記号なら置き換え
    output.textContent = output.textContent.slice(0, -1) + char;
  } else {
    // それ以外は追加
    output.textContent += char;
  }
}

function selectPart(id) {
  const preview = document.getElementById("preview");
  const output = document.getElementById("output");
  
punctIndex = 0;

  if (!state.first) {
    state.first = id;
    preview.textContent = id;
    return;
  }

  if (!state.second) {
    state.second = id;
    preview.textContent = partialMap[`${state.first},${state.second}`] || "";
    return;
  }

  const key = `${state.first},${state.second},${id}`;
  const char = glyphMap[key];
  if (char) {
    output.textContent += char;
  }

  state = { first: null, second: null };
  preview.textContent = "";
}

function inputSymbol(char) {
  const output = document.getElementById("output");
  const preview = document.getElementById("preview");

  output.textContent += char;

  state = { first: null, second: null };
  preview.textContent = "";
}

function backspace() {
  const output = document.getElementById("output");
  const preview = document.getElementById("preview");

  if (state.second) {
    state.second = null;
    preview.textContent = state.first;
    return;
  }

  if (state.first) {
    state.first = null;
    preview.textContent = "";
    return;
  }

  output.textContent = output.textContent.slice(0, -1);
}
</script>

</body>

</html>
